"use strict";(self["webpackChunktoutiao_m"]=self["webpackChunktoutiao_m"]||[]).push([[42],{9042:function(t,e,o){o.r(e),o.d(e,{default:function(){return X}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{attrs:{title:"黑马头条","left-arrow":"",fixed:""},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"main-warp"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#1989fa",vertical:""}},[t._v("加载中。。。")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-image",{staticClass:"avatar",attrs:{round:"",fit:"cover",src:t.article.aut_photo}})]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticClass:"user-name"},[t._v(t._s(t.article.aut_name))])]},proxy:!0},{key:"label",fn:function(){return[e("div",{staticClass:"publish-date"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]},proxy:!0},{key:"right-icon",fn:function(){return[e("FollowUser",{attrs:{userId:t.article.aut_id,isFollowed:t.article.is_followed},on:{"update:isFollowed":function(e){return t.$set(t.article,"is_followed",e)},"update:is-followed":function(e){return t.$set(t.article,"is_followed",e)}}})]},proxy:!0}])}),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("CommentList",{ref:"CommentList",attrs:{targetId:t.articleId,totalCount:t.totalCommentCount},on:{"update:totalCount":function(e){t.totalCommentCount=e},"update:total-count":function(e){t.totalCommentCount=e},replyClick:t.onReplyClick}})],1):404===t.errStatus?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArticleInfo}},[t._v(" 点击重试")])],1)]),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{name:"comment-o",badge:t.totalCommentCount}}),e("CollectArticle",{attrs:{articleId:t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("LikeArticle",{attrs:{articleId:t.article.art_id,attitude:t.article.attitude},on:{"update:attitude":function(e){return t.$set(t.article,"attitude",e)}}}),e("van-icon",{attrs:{name:"share"}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{targetId:t.article.aut_id},on:{"post-success":t.onPostSuccess}})],1),e("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("CommentReply",{attrs:{comment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},n=[],i=o(432),a=function(){var t=this,e=t._self._c;return t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{round:"",type:"info",size:"small",icon:"plus",loading:t.btnLoading},on:{click:t.onFollow}},[t._v(" 关注 ")]):e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.btnLoading},on:{click:t.onFollow}},[t._v(" 已关注 ")])},l=[],r={name:"FollowUser",props:{isFollowed:{type:Boolean,default:!0},userId:{type:String,default:""}},data(){return{btnLoading:!1}},methods:{async onFollow(){this.btnLoading=!0;try{this.isFollowed?await(0,i.YE)(this.userId):await(0,i.u5)(this.userId),this.$emit("update:isFollowed",!this.isFollowed)}catch(t){console.log(t),t.response&&400===t.response.status?this.$toast("你不能关注你自己"):this.$toast("操作失败,请重试")}setTimeout((()=>{this.btnLoading=!1}),1e3)}}},c=r,m=o(1001),u=(0,m.Z)(c,a,l,!1,null,"bd5c1bdc",null),d=u.exports,p=function(){var t=this,e=t._self._c;return e("van-icon",{class:{collected:t.value},attrs:{name:t.value?"star":"star-o",loading:t.btnLoading},on:{click:t.onCollect}})},h=[],f={name:"CollectArticle",props:{value:{type:Boolean,default:!0},articleId:{type:String,default:""}},data(){return{btnLoading:!1}},methods:{async onCollect(){this.btnLoading=!0;try{this.value?await(0,i.u1)(this.articleId):await(0,i.$c)(this.articleId),this.$emit("input",!this.value)}catch(t){this.$toast("收藏文章失败")}setTimeout((()=>{this.btnLoading=!1}),1e3)}}},C=f,v=(0,m.Z)(C,p,h,!1,null,"d9f91daa",null),g=v.exports,_=function(){var t=this,e=t._self._c;return e("van-icon",{class:{collected:1===t.attitude},attrs:{name:1===t.attitude?"good-job":"good-job-o",loading:t.btnLoading},on:{click:t.onCollect}})},y=[],b={name:"LikeArticle",props:{attitude:{type:Number,default:-1},articleId:{type:String,default:""}},data(){return{btnLoading:!1}},methods:{async onCollect(){this.btnLoading=!0;let t=this.attitude;try{1===this.attitude?(t=-1,await(0,i.nD)(this.articleId)):(t=1,await(0,i.IF)(this.articleId)),this.$emit("update:attitude",t)}catch(e){this.$toast("点赞不成功")}setTimeout((()=>{this.btnLoading=!1}),1e3)}}},w=b,k=(0,m.Z)(w,_,y,!1,null,"8a8a852a",null),I=k.exports,S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-list"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败,点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(o,s){return e("CommentItem",{key:s,attrs:{comment:o},on:{replyClick:t.onReplyClick}})})),1)],1)},L=[],x=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item",attrs:{title:t.comment.content},scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-image",{staticClass:"avatar",attrs:{round:"",fit:"cover",src:t.comment.aut_photo}})]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))])]},proxy:!0},{key:"label",fn:function(){return[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("div",{staticClass:"publish-date"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"replay-btn",attrs:{round:""},on:{click:function(e){return t.$emit("replyClick",t.comment)}}},[t._v(" 回复"+t._s(t.comment.reply_count)+" ")])],1)]},proxy:!0},{key:"right-icon",fn:function(){return[e("van-button",{staticClass:"like-btn",class:{like:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",loading:t.btnLoading},on:{click:t.onCommentLike}},[t._v(" "+t._s(t.comment.like_count||"赞")+" ")])]},proxy:!0}])})},$=[],P={name:"CommentItem",props:{comment:{type:Object,default:()=>({})}},data(){return{btnLoading:!1,commentClone:this.comment}},methods:{async onCommentLike(){this.btnLoading=!0;try{this.comment.is_liking?(await(0,i.IY)(this.comment.com_id),this.commentClone.like_count--):(await(0,i._7)(this.comment.com_id),this.commentClone.like_count++),this.commentClone.is_liking=!this.comment.is_liking}catch(t){console.log(t),this.$toast("操作失败,请重试")}setTimeout((()=>{this.btnLoading=!1}),1e3)}}},F=P,R=(0,m.Z)(F,x,$,!1,null,"5ba7d4be",null),A=R.exports,Z={name:"CommentList",components:{CommentItem:A},props:{targetId:{type:String,default:""},totalCount:{type:Number,default:0},type:{type:String,default:"a"}},data(){return{list:[],loading:!1,finished:!1,error:!1,offset:null}},methods:{onReplyClick(t){this.$emit("replyClick",t)},async onLoad(){try{const{data:t}=await(0,i.nr)({type:this.type,source:this.targetId,offset:this.offset,limit:10});console.log(t),this.list.push(...t.data.results),this.$emit("update:totalCount",t.data.total_count),this.loading=!1,t.data.results.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},unshiftComment(t){this.list.unshift(t.new_obj)}}},T=Z,j=(0,m.Z)(T,S,L,!1,null,"02530119",null),z=j.exports,U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"优质评论将会被优先显示","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{size:"small",disabled:!t.message.length},on:{click:t.onAddComment}},[t._v(" 发布 ")])],1)},B=[],D={name:"CommentPost",props:{targetId:{type:String,default:""},articleId:{type:String,default:""}},data(){return{message:""}},methods:{async onAddComment(){try{const t=this.message.trim();if(!t.length)return;const{data:e}=await(0,i.AD)({target:this.targetId,content:this.message,art_id:this.articleId||null});console.log(e),this.message="",this.$emit("post-success",e.data),this.$toast.success("发布成功")}catch(t){this.$toast.fail("发布失败")}}}},E=D,N=(0,m.Z)(E,U,B,!1,null,"3668b750",null),O=N.exports,Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:t.comment.reply_count>0?`${t.comment.reply_count}条回复`:"暂无回复","left-arrow":"",fixed:""},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.$emit("close")}}})]},proxy:!0}])}),e("div",{staticClass:"scroll-wrap"},[e("CommentItem",{attrs:{comment:t.comment}}),e("van-cell",[t._v("全部回复")]),e("CommentList",{ref:"CommentList",attrs:{targetId:t.comment.com_id,type:"c"}})],1),e("div",{staticClass:"reply-bottom"},[e("van-button",{staticClass:"reply-btn",attrs:{round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v(" 写评论 ")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{targetId:t.comment.com_id,articleId:t.$route.params.articleId},on:{"post-success":t.onPostSuccess}})],1)],1)},q=[],H={name:"CommentReply",components:{CommentItem:A,CommentList:z,CommentPost:O},props:{comment:{type:Object,default:()=>({})}},data(){return{commentClone:this.comment,isPostShow:!1}},methods:{onPostSuccess(t){this.commentClone.reply_count++,this.isPostShow=!1,this.$refs.CommentList.unshiftComment(t)}}},M=H,G=(0,m.Z)(M,Y,q,!1,null,"22aacd83",null),J=G.exports,K=o(6471),Q={name:"articleIndex",components:{FollowUser:d,CollectArticle:g,LikeArticle:I,CommentList:z,CommentPost:O,CommentReply:J},props:{articleId:{type:String,default:""}},data(){return{article:{},loading:!0,errStatus:0,totalCommentCount:0,isPostShow:!1,isReplyShow:!1,currentComment:{}}},created(){this.loadArticleInfo()},methods:{async loadArticleInfo(){this.loading=!0;try{const{data:t}=await(0,i.rk)(this.articleId);console.log(t),this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404),this.$toast("获取失败")}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img");console.log(e);const o=[...e].map((t=>t.src));e.forEach(((t,e)=>{t.onclick=()=>{(0,K.Z)({images:o,startPosition:e})}}))},onPostSuccess(t){this.isPostShow=!1,this.$refs.CommentList.unshiftComment(t),console.log(t)},onReplyClick(t){this.currentComment=t||{},console.log(t),this.isReplyShow=!0}}},V=Q,W=(0,m.Z)(V,s,n,!1,null,"50a4f4ce",null),X=W.exports}}]);
//# sourceMappingURL=42.c92d8999.js.map